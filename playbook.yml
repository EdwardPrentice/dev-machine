---
- hosts: all
  become: true
  pre_tasks:
    - name: Dist update
      apt: upgrade=dist update_cache=yes cache_valid_time=86400 # a day
    - name: Package update
      apt: upgrade=full update_cache=yes cache_valid_time=86400
  roles:
    - role: geerlingguy.git
    - role: geerlingguy.java
    - role: geerlingguy.nodejs
    - role: geerlingguy.pip
    - role: geerlingguy.docker
  tasks:
  - name: Install desktop
    apt:
      name:
        - mate-desktop-environment-extras
        - lightdm
      state: present
  - name: Configure desktop
    shell: dpkg-reconfigure lightdm
  - name: Configure autologin
    blockinfile:
      path: /usr/share/lightdm/lightdm.conf.d/60-lightdm-gtk-greeter.conf
      create: yes
      block: |
        [SeatDefaults]
        greeter-session=lightdm-gtk-greeter
        autologin-user=vagrant
  - name: Disable lock screen
    shell: |
      gsettings set org.gnome.desktop.session idle-delay 0
      gsettings set org.mate.screensaver lock-enabled false
  - name: Copy wallpaper # https://www.reddit.com/r/wallpaper/comments/b2vuhx/sr71_blackbird_19201080/eivjsti/
    copy: src=wallpaper.jpg dest=/home/vagrant/.wallpaper.jpg
  - name: Set wallpaper
    become: vagrant
    shell: gsettings set org.mate.background picture-filename /home/vagrant/.wallpaper.jpg
  post_tasks:
  - name: Clean
    apt: autoremove=yes autoclean=yes